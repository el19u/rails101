<% is_in_group = current_user && current_user.is_member_of?(@group) %>

<div class="col-md 12">
  <h2><%= @group.title %></h2>

  <div class="group">
    <span class="float-end">
      <% if is_in_group %>
        <label class="label label-success">群組成員</label>
        <%= link_to("離開群組", quit_group_path(@group), method: :post, class: "btn btn-default") %>
      <% else %>
        <label class="label label-warning">非群組成員</label>
        <%= link_to("加入群組", join_group_path(@group), method: :post, class: "btn btn-default") %>
      <% end %>
    </span>
  </div>
  <div class="group">
    <% if is_in_group %>
      <%= link_to("新增文章", new_group_post_path(@group), class: "btn btn-default float-end" ) %>
    <% end %>
  </div>
  <% if current_user && current_user == @group.user %>
    <%= link_to("編輯", edit_group_path(@group), class: "btn btn-primary float-end") %>
  <% end %>

  <% if @group.user == current_user %>
    <h2>待審核文章（管理員）</h2>
    <table class="table">
      <thead>
        <tr>
          <th>文章內容</th>
          <th>作者</th>
          <th>時間</th>
          <th colspan="3" class="text-center">操作</th>
        </tr>
      </thead>
      <tbody>
        <% @verify_posts.each do |post| %>
          <tr>
            <td><%= post.content %></td>
            <td><%= post.user.email %></td>
            <td><%= post.updated_at %></td>
            <td><%= button_to("審核通過", manage_group_post_path(@group, post, post:{status: "published"}))%></td>
            <td><%= button_to("審核失敗", manage_group_post_path(@group, post, post:{status: update_success_fail(post.status)}))%></td>
            <td><%= button_to("刪除", manage_group_post_path(@group, post, post: {status: "delete_by_owner"}), data: { confirm: "確定要刪除嗎？"})%></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

  <table class="table">
    <h2>待審核文章（用戶）</h2>
    <thead>
      <tr>
        <th>狀態</th>
        <th>文章內容</th>
        <th>作者</th>
        <th>時間</th>
        <th colspan="2">操作</th>
      </tr>
    </thead>
    <tbody>
      <% @user_posts.each do |post| %>
        <tr>
          <td><%= post.status %></td>
          <td><%= post.content %></td>
          <td><%= post.user.email %></td>
          <td><%= post.updated_at %></td>
          <% if post.status == "pendding" %>
            <td><%= button_to("取消申請審核", manage_group_post_path(@group, post, post: {status: "draft"}))%></td>
          <% else %>
            <td><%= button_to("提交審核", manage_group_post_path(@group, post, post: {status: "pendding"}))%></td>
          <% end %>
          <td><%= link_to("編輯", edit_group_post_path(@group, post)) %></td>
          <td><%= button_to("刪除", manage_group_post_path(@group, post, post: {status: "delete_by_user"}), data: { confirm: "確定要刪除嗎？"})%></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <table class="table">
    <h2>文章列表</h2>
    <thead>
      <tr>
        <th>文章內容</th>
        <th>作者</th>
        <th>時間</th>
        <th>文章狀態</th>
        <th colspan="2">操作</th>
      </tr>
    </thead>
    <tbody>
      <% @posts.each do |post| %>
        <tr>
          <% if post.status == "delete_by_user" && current_user != post.user %>
            <td><%= post.content %></td>
          <% elsif post.status == "block" && current_user == @group.user %>
            <td><%= post.content %></td>
          <% else %>
            <td> - </td>
          <% end %>
          <td><%= post.user.email %></td>
          <td><%= post.updated_at %></td>
          <td><%= post_status_message(post.status) %></td>
          <% if post.status == "published" && current_user == post.user %>
            <td><%= link_to("編輯", edit_group_post_path(@group, post, post: {status: "update_post"})) %></td>
            <td><%= button_to("刪除", manage_group_post_path(@group, post, post: {status: delete_by(current_user, post)}), data: { confirm: "確定要刪除嗎？"})%></td>
          <% end %>
          <% if @group.user == current_user && post.status != "block" && post.status != "delete_by_owner" && post.status != "delete_by_user" %>
            <td><%= button_to("封鎖", manage_group_post_path(@group, post, post: {status: "block"}), data: { confirm: "確定要刪除嗎？"})%></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
  <div>
    <%= paginate @posts %>
  </div>
</div>
